#!/bin/bash

case $1 in
'pylint')
    docker exec schematic $@
    exit
    ;;
'run')
    COMMAND="/usr/local/bin/run"
    ;;
*)
    docker build --tag schematic ./docker/schematic
    COMMAND="bash"
    ;;
esac

RUNNING=$(docker ps --quiet --filter "name=schematic")
if [ -n "${RUNNING}" ]
then
    docker exec --interactive --tty schematic ${COMMAND}
else
    WORKING_DIR="$(pwd)/schematic"
    docker run --rm --interactive --tty \
        --workdir "${WORKING_DIR}" \
        --user $(id -u):$(id -g) \
        --volume "${WORKING_DIR}:${WORKING_DIR}" \
        --name schematic \
        schematic ${COMMAND}
fi
