#!/bin/bash

SDK_ROOT=/usr/local/share/android

case $1 in
'sdk')
    COMMAND=/opt/android/cmdline-tools/bin/sdkmanager
    COMMAND+=" --sdk_root=${SDK_ROOT}"
    COMMAND+=" platforms;android-31"
    COMMAND+=" build-tools;31.0.0"
    echo $COMMAND
    ;;
'build' | 'test')
    COMMAND="/opt/gradle/gradle-8.3/bin/gradle ${1}"
    ;;
*)
    COMMAND='bash'
    ;;
esac

docker build --progress=plain --tag android_gpo ./docker

docker run \
    --rm --interactive --tty \
    --volume $(pwd)/kotlin:/usr/local/src \
    --volume $(pwd)/temp:/var/gradle \
    --volume $(pwd)/share:${SDK_ROOT} \
    --user $(id -u):$(id -g) \
    --name android_gpo \
    android_gpo ${COMMAND}
